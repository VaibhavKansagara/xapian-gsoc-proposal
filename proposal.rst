.. This document is written in reStructuredText, a simple and unobstrusive
.. markup language.  For an introductiont to reStructuredText see:
.. 
.. https://www.sphinx-doc.org/en/master/usage/restructuredtext/basics.html
.. 
.. Lines like this which start with `.. ` are comments which won't appear
.. in the generated output.
.. 
.. To apply for a GSoC project with Xapian, please fill in the template below.
.. Placeholder text for where you're expected to write something says "FILLME"
.. - search for this in the generated PDF to check you haven't missed anything.
.. 
.. See our GSoC Project Ideas List for some suggested project ideas:
.. https://trac.xapian.org/wiki/GSoCProjectIdeas
..
.. You are also most welcome to propose a project based on your own ideas.
.. 
.. From experience the best proposals are ones that are discussed with us and
.. improved in response to feedback.  You can share draft applications with
.. us by forking the git repository containing this file, filling in where
.. it says "FILLME", committing your changes and pushing them to your fork,
.. then opening a pull request to request us to review your draft proposal.
.. You can do this even before applications officially open.
.. 
.. IMPORTANT: Your application is only valid is you upload a PDF of your
.. proposal to the GSoC website at https://summerofcode.withgoogle.com/ - you
.. can generate a PDF of this proposal using "make pdf".  You can update the
.. PDF proposal right up to the deadline by just uploading a new file, so don't
.. leave it until the last minute to upload a version.  The deadline is
.. strictly enforced by Google, with no exceptions no matter how creative your
.. excuse.
.. 
.. If there is additional information which we haven't explicitly asked for
.. which you think is relevant, feel free to include it. For instance, since
.. work on Xapian often draws on academic research, it's important to cite
.. suitable references both to support any position you take (such as
.. 'algorithm X is considered to perform better than algorithm Y') and to show
.. which ideas underpin your project, and how you've had to develop them
.. further to make them practical for Xapian.
.. 
.. You're welcome to include diagrams or other images if you think they're
.. helpful - for how to do this see:
.. https://www.sphinx-doc.org/en/master/usage/restructuredtext/basics.html#images
.. 
.. Please take care to address all relevant questions - attention to detail
.. is important when working with computers!
.. 
.. If you have any questions, feel free to come and chat with us on IRC, or
.. send a mail to the mailing lists.  To answer a very common question, it's
.. the mentors who between them decide which proposals to accept - Google just
.. tell us HOW MANY we can accept (and they tell us that AFTER student
.. applications close).
.. 
.. Here are some useful resources if you want some tips on putting together a
.. good application:
.. 
.. "Writing a Proposal" from the GSoC Student Guide:
.. https://google.github.io/gsocguides/student/writing-a-proposal
.. 
.. "How to write a kick-ass proposal for Google Summer of Code":
.. https://teom.wordpress.com/2012/03/01/how-to-write-a-kick-ass-proposal-for-google-summer-of-code/

=======================================
Project: Learning to Rank Stabilisation
=======================================

About You
=========

 * Name: VAIBHAV KANSAGARA

 * E-mail address: vaibhavkansagara249@gmail.com

 * IRC nickname(s): vaibhav,vaibhavkansagara

 * Any personal websites, blogs, social media, etc: https://www.facebook.com/vaibhav.kansagara

 * github URL: https://github.com/VaibhavKansagara

 * linkedln URL: https://www.linkedin.com/in/vaibhav-kansagara-087331156/

 * Biography: I am 3rd year undergraduate currently pursuing Integrated Mtech in Computer Science at International Institute of Information Technology,Bangalore. I was selected for ACM-ICPC Amritapuri Regionals in 2018. I love machine learning and coding in C++ and competitive programming.

Background Information
----------------------

.. The answers to these questions help us understand you better, so that we can
.. help ensure you have an appropriately scoped project and match you up with a
.. suitable mentor or mentors.  So please be honest - it's OK if you don't have
.. much experience, but it's a problem if we aren't aware of that and propose
.. an overly ambitious project.

**Have you taken part in GSoC and/or GCI (https://codein.withgoogle.com/) and/or
similar programmes before?  If so, tell us about how it went, and any areas you
would have liked more help with.**

No I haven't taken part in previous GSoC or GCI.

**Please tell us about any previous experience you have with Xapian, or other
systems for indexed text search.**

I started contributing to xapian around December 15th,2018 and have been contributing since.
My contributions include

Pull requests:

* https://github.com/xapian/xapian/pull/213 (Merged)
* https://github.com/xapian/xapian/pull/214 (Merged)
* https://github.com/xapian/xapian/pull/215 (Merged)
* https://github.com/xapian/xapian/pull/216 (Merged)
* https://github.com/xapian/xapian/pull/221 (Merged)
* https://github.com/xapian/xapian/pull/217 (Not to be merged due to conflicting licence issues)
* https://github.com/xapian/xapian/pull/225 (Open)
* https://github.com/xapian/xapian/pull/226 (Merged)

Issues:

* https://github.com/xapian/xapian/commit/3839e37679b7abbe2df20ed7b37de85bbfb79bb9
* https://github.com/xapian/xapian/commit/2a980274452b642739f799f0c066d9cdfb3048da
* https://github.com/xapian/xapian/commit/eacae4a631376d29aee5491b5f48304c42c38f30


**Tell us about any previous experience with Free Software and Open Source
other than Xapian.**

I had no experience with open source prior to xapian.

**What other relevant prior experience do you have (courses taken at college,
hobbies, holiday jobs, etc)?**

Courses taken at my college include:
Programming-I,Programming-II,Data structures and Algorithms,Mathematics for Machine Learning,
Mathematics,Machine Learning,Discrete Mathematics,Design and Analysis of Algorithms,Database Systems,Computer Network,
Computer Architecture.

Projects(Work included in github repository):

*C++ Image Processing Toolkit:*

Developed a small scale image-processing toolkit for .ppm files that implements basic features like
composite two images, histogram of the input image, apply Gaussian filter, add noise to the input
image, Image stenciling, binarization, segmentation,connected component labelling.

*Taxi Aggregation Project:*

Developed a Taxi Aggregator Simulator using Java which assigns nearest available car to the user. The
app periodically checks the status and locations of all cars and trips and updates the display.

*Rossman Store Sales Prediction*

Developed supervised classification model using machine learning algorithm’s like Random Forest,
Xgboost to forecast the sales.

*Student Information System*

Our project revolves around the fact that it can manage student’s data with great ease. Our project
employs a ’Menu-driven’ system which makes it user-friendly. It also uses files as database to perform
file handling operations such as add, search, delete and displaying records to manage students records.

*Projects related to Computer Graphics*

CG-Assignment1: Developed a 2D graphical application for rendering a touch-screen calculator.

CG-Assignment2: Developed a 3D application for rendering various models,thier movements.Details can be
found on github repository.

*Hobbies*

Playing Football and Badminton.

Coding

Like watching tv-series

**What development platforms, tools and methods do you prefer to use?**

I use Visual Studio Code primarily for development and debugging purposes. I occassionaly use Sublime Text.
I have ubuntu 18.04.1 LTS (Bionic Beaver) installed in my system.

**Have you previously worked on a project of a similar scope?  If so, tell us
about it.**

No I haven't worked on a project of such scope(open-source magnitude) but I have worked on large projects
involving C++ and machine learning which are mentioned above.

**What timezone will you be in during the coding period?**

UTC 3:30 am to UTC 12:30 pm

**Will your Summer of Code project be the main focus of your time during the
program?**

Yes, Summer of Code project will be the main focus of my time during the program.

**Expected work hours (e.g. Monday–Friday 9am–5pm UTC)**

50-60 hours but depending on the organisation needs i am willing to devote more time to the program if necessary.

**Are you applying for other projects in GSoC this year?  If so, with which
organisation(s)?**

.. We understand students sometimes want to apply to more than one org and
.. we don't have a problem with that, but it's helpful if we're aware of it
.. so that we know how many backup choices we might need.

No, I am not applying to any other organisation.

Your Project
============

Motivations
-----------

**Why have you chosen this particular project?**

I have chosen this project because I have decent knowledge of C++ in which most of the coding is to be done and I also have
decent knowledge of machine learning. I have done various projects in machine leaning and C++ therefore I am quite comfortable in understanding
the codebase and implementing new features and writing tests.

**Who will benefit from your project and in what ways?**

.. For example, think about the likely user-base, what they currently have to
.. do and how your project will improve things for them.

Ranking is the central part of almost all of the information retrieval problems and academic research has proved that Learning-to-Rank
has been shown to perform better than unsupervised ranking models like TF-IDF or BM-25. Currently the letor system in xapian is untested
and not ready to be fully releasable and this project aims to make it releasable by the end of the summer. This will have direct impact
on the ranking effectivness of xapian and this project also aims to make xapian-evaluation releasable which will provide a platform
to evaluate the performance of all the ranking schemes currently present in xapian against standard benchmark datasets.
Thus this will benefit all the organisations currently using xapian. 

Project Details
---------------

.. Please go into plenty of detail in this section.

**Describe any existing work and concepts on which your project is based.**

There are broadly 6 stages in which the project is divided:

*Create practical code examples that use core features and API.*

In this part i propose to extend the already existing PR of ayush_pandey and add more examples of the API's.
Specifically there is no example use of xapian-letor-update.cc file which I would like to add.
There are certain issues in that PR which need to be fixed. Also the example code is only available for C++,therefore I propose
to write example codes in Python,Java and other languages as well.

*Based on this experience, propose (and document) any changes to the user-facing APIs that will make it a more practical system
to use (in particular, there are magic numbers in part of the current user-facing API which should be replaced either with
symbolic constants or directly using C++ polymorphism features).*

This part is mostly dependent on the above part and as such details about this part would be figured when new issues arises in the
first part.

*Add more detailed tests of both the higher-level API and the lower-level pieces (so for instance a particular Feature can be tested
independently of the overall API), and also looking at corner cases and exceptional behaviour*

This part involves writing test about each and every API(non-existing). I have written a sample unittest for one feature in #226 which would be
easy to extend for the remaining 16 features which broadly comprises of 3 test(title,body,whole) of individual feature like TfDoclenfeature and
last one being weight.Additionally this project invloves addition of various different rankers and score metrics which would need
their individual tests as well. Also currently ranker tests(for rankers like listmle,listnet,svmranker) are not detailed enough which
test each and every function(method)so i would like to add more detailed test which cover entire API for rankers.

*Create an evaluation and performance reporting system for letor, so that both usefulness and speed
can be investigated. This should use public datasets. Integrate remaining rankers and scorers.*


This part includes fixing the xapian-evaluation module whose code is pretty messy.
Some of the issues include indentation,Segmentation fault when used with articles which does not end with "</DOC>".
The reason for segmentation fault is that it is not able to determine the end of the document which renders into an infinite loop.
Fix would be make it automatically detect the end tag of the document from the start tag of the document.
Segmentation fault when used with very large files because in the src/trec_index.cc file curpos variable is an integer which will overflow
after a certain point. Simple fix is to convert it to long long which would not cause the check defined at line 149 in src/trec_index.cc file
to fail and thus prevent it from entering an infinite loop.Also after the fixing all issues, it should not give segmentation fault on invalid
formats.There are many more issues likely to come up during furthur investigation.

Assuming all the issuses get resolved,

1)For evaluating letor we can just re-rank the document id's after line 180(src/trec_search.cc) to get the new ranks if the user opts for
letor scheme and in line 193(src/trec_search.cc) we need to pass the new rank.

2)The above scheme must include options for selecting different ranker algorithms.

3)MAP score evaluation implementation is already there and for NDCG score we just need to use the already existing evaluation and have a
corresponding print statement in src/trec_adhoceval.cc.

*Ensure that make dist works and produces a useful distribution archive (this allows us to do our first proper release of letor) we will
probably want to add make distcheck to one of the buildbot configurations*

Currently running make dist fails with a libtool error "cannot find the library '/home/vaibhav/Desktop/xapian/xapian-core/libxapian-1.5.la' or
unhandled argument '/home/vaibhav/Desktop/xapian/xapian-core/libxapian-1.5.la'". I plan to solve this issue during the community bonding period.

*Add bindings support, via our existing SWIG-based bindings approach so that we get a range of languages at once. At least initially we don't
need to be able to subclass any Letor classes in the bindings, just use Letor functionality from other languages*

I plan to study about bindings during community bonding period and implement bindings for different languages.

*Add support for the database backend to track the length of fields would avoid having to handle this specially as a feature for Letor, 
and would also allow implementation of weighting schemes like BM25F and PL2F*

This part involves about 5 steps and likely more:

1) For getting document fields like len("title"),len("body"),len("whole") we should have members which store each of these and a method to
retrieve them in document class, as such methods doesn't exist currently in the document class

2)Implement methods in Database class which takes the docid and return the corresponding information

3)remove the corresponding code to calculate these from compute_doc_length() method in featurelist_internal.cc

4)For database backends which doesn\'t support metadata we need to store the information of len("title"),len("body"),len("whole") of 
entire database and have methods for retrieving them.

5)remove the corresponding code from compute_collection_length() method in featurelist_internal.cc.

**These are low-priority ideas to develop letor incase everything goes as planned.**

*Use a linear regression approach to combine the scores given by different Rankers*

*A feature reduction technique can be added to eliminate redundant features.*

*Issues regarding implementation of letor*

There are certain issues which needs to be sorted out and were discussed with the mentors on IRC channel.
Some of them include:

For ListMle ranker in file listmle_ranker.cc at line 123 there is a sort function which generates permutation but it
won't be completely random.

The way the document id is parsed in the "qrel" file.The xapian one is a positive integer and the letor one a string.
Eliminating this would be beneficial.

**Deleiverables**

* Make the xapian-letor releasable with extensive test,documentation,example code.

* Make the xapian-evaluation module releasable.

* Integrate more rankers and scorers with letor and test for them.

* Write bindings for xapian-letor.

**Do you have any preliminary findings or results which suggest that your
approach is possible and likely to succeed?**

As the project is about writing test for various api's and for fixing the evaluation module this question doesn't apply to
this project.

**What other approaches to have your considered, and why did you reject those in
favour of your chosen approach?**

Doesn't apply to this project.

**Please note any uncertainties or aspects which depend on further research or
investigation.**

The most important uncertainity in this project is that while testing the system new bugs and design issues can come up which
can't be predicted before actually implementing the tests.
If everything go as planned I plan to contribute more ranker algorithms and more score metrics for letor system.
Also I am interested in doing two other project's, Matcher Optimisations and Weighting Schemes if this project get's completed before time.
I also plan to become a long-time contributor to xapian. Primary motivation is that it will help me learn new and more practical things.
Doing an open source project teaches you a lot and I plan to extract the maximum out of it. I plan to complete the above two projects I
mentioned after or during gsoc.

**How useful will your results be when not everything works out exactly as
planned?**

Assuming the worst case scenario I plan to atleast make the xapian-letor system and xapian evaluation module releasable which will be
extremely useful to the xapian community as the whole system is tested,documented and through evaluation module they can get the idea of
how good the current system is performing against standard benchmark datasets.


Project Timeline
----------------

.. We want you to think about the order you will work on your project, and
.. how long you think each part will take.  The parts should be AT MOST a
.. week long, or else you won't be able to realistically judge how long
.. they might take.  Even a week is too long really.  Try to break larger
.. tasks down into sub-tasks.
.. 
.. The timeline helps both you and us to know what you should do next, and how
.. on track you are.  Your plan certainly isn't set in stone - as you work on
.. your project, it may become clear that it is better to work on aspects in a
.. different order, or you may some things take longer than expected, and the
.. scope of the project may need to be adjusted.  If you think that's the
.. case during the project, it's better to talk to us about it sooner rather
.. than later.
.. 
.. You should strive to break your project down into a series of stages each of
.. which is in turn divided into the implementation, testing, and documenting of
.. a part of your project. What we're ideally looking for is for each stage to
.. be completed and merged in turn, so that it can be included in a future
.. release of Xapian. Even if you don't manage to achieve everything you
.. planned to, the stages you do complete are more likely to be useful if
.. you've structured your project that way. It also allows us to reliably
.. determine your progress, and should be more satisfying for you - you'll be
.. able to see that you've achieved something useful much sooner!
.. 
.. Look at the dates in the timeline:
.. https://summerofcode.withgoogle.com/how-it-works/
.. 
.. There are about 3 weeks of "community bonding" after accepted students are
.. announced.  During this time you should aim to complete any further research
.. or other issues which need to be done before you can start coding, and to
.. continue to get familiar with the code you'll be working on.  Your mentors
.. are there to help you with this.  We realise that many students have classes
.. and/or exams in this time, so we certainly aren't expecting full time work
.. on your project, but you should aim to complete preliminary work such that
.. you can actually start coding at the start of the coding period.
.. 
.. The coding period is broken into three blocks of about 4 weeks each, with
.. an evaluation after each block.  The evaluations are to help keep you on
.. track, and consist of brief evaluation forms sent to GSoC by both the
.. student and the mentor, and a chance to explicitly review how your project
.. is going with Xapian mentors.
.. 
.. If you will have other commitments during the project time (for example,
.. any university classes or exams, vacations, etc), make sure you include them
.. in your project timeline.

Timeline:

Community Bonding Period: May 6-27

Understand the codebase.Learn more about swig-based bindings and about make dist error in xapian-letor.

Week-1 May 27-June 3 

Create practical code examples that use core features and API,fix the issues with the incomplete PR
of ayush_pandey.

Week-2 June 3-June 10

Write the example code for xapian-letor in python,java etc.

Week-3 June 10-June 17

Write test about various api\'s and unit test cases for features.

Week-4 June 17-June 24

Write test about various api\'s and unit test cases for features(continued). 
Fix other known issues in xapian-letor.

Phase 1 Evaluation

Week-5 June 24-July 1 

Fix the problem with make dist in xapian-letor and make xapian-letor officially releasable.

Week-6 July 1-July 8

Fix the issues discussed above and likely many more in xapian-evaluation module.

Week-7 July 8-July 15

Fix the issues discussed above and likely many more in xapian-evaluation module(continued).
Also fix other known issues or tickets.

Week-8 July 15-July 22

Start Adding binding support for various languages.

Phase 2 Evaluation

Week-9 July 22-July 29

Finish Adding binding support for various languages.

Week-10 July 29-August 5

Add support for database backend to track the length of the fields.

Week-11 August 5-August 12

Implement Linear regression combining the scores of different rankers.

Week-12 August 12-August 19

Write test for Linear regression and documentation for linear regression.

Week-13 August 19-August 26

Buffer period for any remaining work.

Phase 3 Evaluation.

Honestly I think I will be able to contribute much more to the project than the above proposed changes.

Previous Discussion of your Project
-----------------------------------

.. If you have discussed your project on our mailing lists please provide a
.. link to the discussion in the list archives.  If you've discussed it on
.. IRC, please say so (and the IRC handle you used if not the one given
.. above).

Yes, I have discussed the project in detail on IRC with the mentors.

Licensing of your contributions to Xapian
-----------------------------------------

**Do you agree to dual-license all your contributions to Xapian under the GNU
GPL version 2 and all later versions, and the MIT/X licence?**

For the avoidance of doubt this includes all contributions to our wiki, mailing
lists and documentation, including anything you write in your project's wiki
pages.

Yes I agree to dual-license all my contributions to Xapian under the GNU
GPL version 2 and all later versions, and the MIT/X licence.

.. For more details, including the rationale for this with respect to code,
.. please see the "Licensing of patches" section in the "HACKING" document:
.. https://trac.xapian.org/browser/git/xapian-core/HACKING#L1399

Use of Existing Code
--------------------

**If you already know about existing code you plan to incorporate or libraries
you plan to use, please give details.**

Not needed in this project.

.. Code reuse is often a desirable thing, but we need to have a clear
.. provenance for the code in our repository, and to ensure any dependencies
.. don't have conflicting licenses.  So if you plan to use or end up using code
.. which you didn't write yourself as part of the project, it is very important
.. to clearly identify that code (and keep existing licensing and copyright
.. details intact), and to check with the mentors that it is OK to use.
